- name: Configure Local Settings
  hosts: localhost
  connection: local
  become: no
  roles:
    - { role: local/known-hosts, tags: local }

- name: Bootstrap Required Users
  hosts: all
  remote_user: root
  become: no
  gather_facts: no
  roles:
    - { role: bootstrap/users, tags: users }

- name: Harden Kubernetes Nodes
  hosts: all
  remote_user: deployer
  become: true
  roles:
    - { role: dev-sec.os-hardening, tags: hardening }
    - { role: dev-sec.ssh-hardening, tags: hardening }
  vars:
    sysctl_overwrite:
      net.ipv6.conf.all.disable_ipv6: 0

- name: Bootstrap Kubernetes Nodes
  hosts: all
  remote_user: deployer
  become: true
  roles:
    - { role: bootstrap/nodes, tags: nodes }

- name: Install Kubernetes
  become: true
  remote_user: deployer
  import_playbook: kubespray/cluster.yml
  tags: kubespray
